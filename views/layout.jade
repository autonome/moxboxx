mixin playlist(playlists)
  ol#playlists
    for playlist in playlists
      li(data-id='#{playlist.id}', data-action='/playlist/', class='item')
        a(href='/user/#{playlist.owner.id}')
          img(src='#{playlist.owner.gravatar}', title="#{playlist.owner.username}")
        h2
          a(href='/playlist/#{playlist.id}', title='#{playlist.title}', class='playlist-title')
            = playlist.title
            span.count #{playlist.moxes.length}
        time= playlist.created

        if session.email
          .item-actions
            if parseInt(session.userId, 10) === parseInt(playlist.owner.id, 10)
              a(href='javascript:;', class='playlist-delete', data-context='playlist-delete') delete
            if playlist.isStarred
              a(href='javascript:;', data-id='#{playlist.id}', class='playlist-star on', data-action='/playlist/star/', data-context='playlist-star') unstar
            else
              a(href='javascript:;', data-id='#{playlist.id}', class='playlist-star', data-action='/playlist/star/', data-context='playlist-star') star

!!! 5
html
  head
    title moxboxx
    meta(content='chrome=1', http-equiv='X-UA-Compatible')
    link(rel='shortcut icon', href='/images/favicon.png')
    link(rel='stylesheet', href='/stylesheets/main.css')
    script(type='text/javascript')
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-4319539-42']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
  body(style='background-image: url(#{background});', class='page-#{pageType}')
    #flash
    header
      a(href='/', id='logo', title='Home') moxboxx

      ul.actions
        if session.email
          if session.username
            li
              a(href='javascript:;') Playlists
              ul
                li
                  a(href='/user/#{session.userId}') View Playlists
                li
                  a(href='/playlist/new') Create Playlist
                li
                  a(href='/playlists/starred') View Starred
          li
            a(href='javascript:;') You
            ul
              li
                a(href='/user/#{session.userId}') View Profile
              li
                a(href='/profile') Settings
              li
                a(href='#', id='logout') Sign out
        else
          li
            a(href='#', id='login') Sign in with Persona

    .main-wrapper
      .wrapper
        block content
    #footer
      block footer

    script(src='https://login.persona.org/include.js', type='text/javascript')
    script(src='http://www.youtube.com/player_api')
    script(src='/javascripts/froogaloop.js')
    script(src='/javascripts/sc.js')
    script(type='text/javascript')
      var videoList = [];
      var currentPlay;
    script(src='/javascripts/require.js', data-main='/javascripts/main')
